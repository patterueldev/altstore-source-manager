openapi: 3.0.0
info:
  title: AltStore Source Manager API
  description: |
    RESTful API for managing AltStore app sources (apps, versions, builds) 
    and generating valid AltStore source JSON for distribution.
  version: 1.0.0
  contact:
    name: AltStore Source Manager
  license:
    name: MIT

servers:
  - url: http://localhost:8080
    description: Local development server
  - url: https://api.example.com
    description: Production server (placeholder)

tags:
  - name: Health
    description: System health and status endpoints
  - name: Public Sources
    description: Public endpoints for app distribution (no auth required)
  - name: Platform Admin
    description: Platform-level superadmin endpoints (superadmin only)
  - name: Source Admin
    description: Source-scoped admin endpoints (source admin only)

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health Check
      description: Simple health check endpoint to verify the API is running.
      operationId: getHealth
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
              example:
                status: ok

  /sources/{sourceId}:
    get:
      tags:
        - Public Sources
      summary: Get AltStore Source
      description: |
        Returns the AltStore source data for a specific source. 
        This is the public-facing endpoint for app distribution.
        Includes presigned download URLs for IPA files.
      operationId: getSource
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
      responses:
        '200':
          description: AltStore source JSON with presigned URLs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Source'
              example:
                name: My Source
                identifier: com.example.source
                apps:
                  - name: My App
                    bundleIdentifier: com.example.app
                    developerName: Example Dev
                    subtitle: A cool app
                    iconURL: https://example.com/icon.png
                    versions:
                      - version: 1.0.0
                        date: '2025-01-01'
                        localizedDescription: Initial release
                        downloadURL: https://s3.example.com/bucket/com.example.app/1.0.0.ipa?X-Amz-Algorithm=AWS4-HMAC-SHA256&...
                        size: 50000000
                        minOSVersion: '14.0'
                        sha256: abc123def456...

  /sources/{sourceId}/apps:
    get:
      tags:
        - Public Sources
      summary: List All Apps
      description: |
        Retrieve all apps for a source as JSON with presigned download URLs.
        No authentication required.
      operationId: listAppsForSource
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
      responses:
        '200':
          description: List of all apps with presigned URLs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AppPublic'
              example:
                - name: App 1
                  bundleIdentifier: com.example.app1
                  developerName: Dev 1
                  subtitle: First app
                  iconURL: https://example.com/icon1.png
                  versions:
                    - version: '1.0.0'
                      downloadURL: https://s3.example.com/bucket/com.example.app1/1.0.0.ipa?X-Amz-...
        '404':
          description: Source not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Not Found
                message: Source 'invalid' not found

  /sources/{sourceId}/apps/{bundleId}/{version}:
    get:
      tags:
        - Public Sources
      summary: Get App Version Details
      description: Retrieve details for a specific app version including presigned download URL.
      operationId: getAppVersion
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
        - name: bundleId
          in: path
          required: true
          description: The app bundle identifier
          schema:
            type: string
          example: com.example.app
        - name: version
          in: path
          required: true
          description: The semantic version string
          schema:
            type: string
          example: '1.0.0'
      responses:
        '200':
          description: App version details with presigned URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppVersion'
              example:
                version: '1.0.0'
                date: '2025-01-01'
                localizedDescription: Initial release
                downloadURL: https://s3.example.com/bucket/com.example.app/1.0.0.ipa?X-Amz-Algorithm=AWS4-HMAC-SHA256&...
                size: 50000000
                minOSVersion: '14.0'
                sha256: abc123def456...
        '404':
          description: Source, app, or version not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Not Found
                message: Version '1.0.0' not found for app 'com.example.app' in source 'default'

  /admin/sources:
    get:
      tags:
        - Platform Admin
      summary: List All Sources
      description: List all sources (superadmin only).
      operationId: listSources
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of all sources
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Source'
        '401':
          description: Unauthorized (superadmin role required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Unauthorized
                message: Superadmin role required

    post:
      tags:
        - Platform Admin
      summary: Create Source
      description: Create a new source with storage configuration (superadmin only).
      operationId: createSource
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSourceRequest'
            example:
              name: My Source
              storageConfig:
                type: minio
                endpoint: http://minio:9000
                bucketIpas: ipas
                bucketIcons: icons
                accessKeyId: devadmin
                secretAccessKey: devsecret
      responses:
        '201':
          description: Source created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Source'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized (superadmin role required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /admin/sources/{sourceId}:
    get:
      tags:
        - Platform Admin
      summary: Get Source Details
      description: Retrieve a specific source (superadmin only).
      operationId: getSourceAdmin
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
      responses:
        '200':
          description: Source found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Source'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Source not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Platform Admin
      summary: Update Source
      description: Update source metadata and storage configuration (superadmin only).
      operationId: updateSource
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSourceRequest'
      responses:
        '200':
          description: Source updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Source'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Source not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Platform Admin
      summary: Delete Source
      description: Delete a source and all associated data (superadmin only).
      operationId: deleteSource
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
      responses:
        '204':
          description: Source deleted successfully
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Source not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /admin/users:
    get:
      tags:
        - Platform Admin
      summary: List All Users
      description: List all users (superadmin only).
      operationId: listUsers
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of all users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Platform Admin
      summary: Create User
      description: Create a new user (superadmin only).
      operationId: createUser
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: User already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /admin/memberships:
    post:
      tags:
        - Platform Admin
      summary: Assign User to Source
      description: Assign a user to a source with specific roles (superadmin only).
      operationId: assignUserToSource
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMembershipRequest'
            example:
              userId: user123
              sourceId: default
              roles:
                - sourceAdmin
      responses:
        '201':
          description: User assigned successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SourceMembership'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: User already assigned to source
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Platform Admin
      summary: Remove User from Source
      description: Remove a user from a source (superadmin only).
      operationId: removeUserFromSource
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: query
          required: true
          description: The user ID
          schema:
            type: string
        - name: sourceId
          in: query
          required: true
          description: The source ID
          schema:
            type: string
      responses:
        '204':
          description: User removed successfully
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Membership not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /admin/sources/{sourceId}/apps:
    get:
      tags:
        - Source Admin
      summary: List Apps (Admin)
      description: List all apps for a source (source admin only).
      operationId: listAppsAdmin
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
      responses:
        '200':
          description: List of all apps
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/App'
        '401':
          description: Unauthorized (source admin role required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Source not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Source Admin
      summary: Create App
      description: Create a new app in a source (source admin only).
      operationId: createApp
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAppRequest'
            example:
              name: My App
              bundleIdentifier: com.example.app
              developerName: Example Dev
              subtitle: A cool app
              iconURL: https://example.com/icon.png
      responses:
        '201':
          description: App created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: App already exists in this source
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /admin/sources/{sourceId}/apps/{bundleId}:
    get:
      tags:
        - Source Admin
      summary: Get App (Admin)
      description: Retrieve app details (source admin only).
      operationId: getAppAdmin
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
        - name: bundleId
          in: path
          required: true
          description: The app bundle identifier
          schema:
            type: string
          example: com.example.app
      responses:
        '200':
          description: App found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: App not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Source Admin
      summary: Update App
      description: Update app metadata (source admin only).
      operationId: updateApp
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
        - name: bundleId
          in: path
          required: true
          description: The app bundle identifier
          schema:
            type: string
          example: com.example.app
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAppRequest'
      responses:
        '200':
          description: App updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: App not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Source Admin
      summary: Delete App
      description: Delete an app and all its versions (source admin only).
      operationId: deleteApp
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
        - name: bundleId
          in: path
          required: true
          description: The app bundle identifier
          schema:
            type: string
          example: com.example.app
      responses:
        '204':
          description: App deleted successfully
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: App not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /admin/sources/{sourceId}/apps/{bundleId}/versions:
    get:
      tags:
        - Source Admin
      summary: List Versions (Admin)
      description: List all versions for an app (source admin only).
      operationId: listVersionsAdmin
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
        - name: bundleId
          in: path
          required: true
          description: The app bundle identifier
          schema:
            type: string
          example: com.example.app
      responses:
        '200':
          description: List of versions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AppVersion'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: App not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Source Admin
      summary: Create Version
      description: Create a new version for an app (source admin only). Presigned URL is generated server-side.
      operationId: createVersion
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
        - name: bundleId
          in: path
          required: true
          description: The app bundle identifier
          schema:
            type: string
          example: com.example.app
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateVersionRequest'
            example:
              version: '1.0.0'
              date: '2025-01-01'
              localizedDescription: Initial release
              minOSVersion: '14.0'
              sha256: abc123def456...
      responses:
        '201':
          description: Version created; presigned upload URL included for IPA
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateVersionResponse'
              example:
                version: '1.0.0'
                date: '2025-01-01'
                localizedDescription: Initial release
                uploadURL: https://s3.example.com/bucket/com.example.app/1.0.0.ipa?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=...&X-Amz-Expires=3600&...
                minOSVersion: '14.0'
                sha256: abc123def456...
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: App not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Version already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /admin/sources/{sourceId}/apps/{bundleId}/versions/{version}:
    get:
      tags:
        - Source Admin
      summary: Get Version (Admin)
      description: Retrieve version details (source admin only).
      operationId: getVersionAdmin
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
        - name: bundleId
          in: path
          required: true
          description: The app bundle identifier
          schema:
            type: string
          example: com.example.app
        - name: version
          in: path
          required: true
          description: The semantic version string
          schema:
            type: string
          example: '1.0.0'
      responses:
        '200':
          description: Version found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppVersion'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Version not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Source Admin
      summary: Update Version
      description: Update version metadata (source admin only).
      operationId: updateVersion
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
        - name: bundleId
          in: path
          required: true
          description: The app bundle identifier
          schema:
            type: string
          example: com.example.app
        - name: version
          in: path
          required: true
          description: The semantic version string
          schema:
            type: string
          example: '1.0.0'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateVersionRequest'
      responses:
        '200':
          description: Version updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppVersion'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Version not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Source Admin
      summary: Delete Version
      description: Delete a version (source admin only).
      operationId: deleteVersion
      security:
        - bearerAuth: []
      parameters:
        - name: sourceId
          in: path
          required: true
          description: The unique source identifier
          schema:
            type: string
          example: default
        - name: bundleId
          in: path
          required: true
          description: The app bundle identifier
          schema:
            type: string
          example: com.example.app
        - name: version
          in: path
          required: true
          description: The semantic version string
          schema:
            type: string
          example: '1.0.0'
      responses:
        '204':
          description: Version deleted successfully
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Version not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Bearer token with roles claim for authorization

  schemas:
    Source:
      type: object
      description: AltStore source with metadata and storage configuration.
      required:
        - id
        - name
      properties:
        id:
          type: string
          description: Unique source identifier
          example: default
        name:
          type: string
          description: Human-readable name of the source
          example: My Source
        identifier:
          type: string
          nullable: true
          description: Optional reverse-domain identifier for AltStore
          example: com.example.source
        storageConfig:
          $ref: '#/components/schemas/StorageConfig'
        status:
          type: string
          enum: [active, inactive]
          description: Source status
          example: active
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: Last update timestamp

    StorageConfig:
      type: object
      description: Storage backend configuration for a source.
      required:
        - type
        - endpoint
        - bucketIpas
        - bucketIcons
        - accessKeyId
        - secretAccessKey
      properties:
        type:
          type: string
          enum: [minio, s3]
          description: Storage backend type
          example: minio
        endpoint:
          type: string
          format: uri
          description: S3/MinIO endpoint URL
          example: http://minio:9000
        region:
          type: string
          nullable: true
          description: AWS region (for S3)
          example: us-east-1
        bucketIpas:
          type: string
          description: Bucket name for IPA files
          example: ipas
        bucketIcons:
          type: string
          description: Bucket name for app icons
          example: icons
        accessKeyId:
          type: string
          description: Access key ID (stored encrypted)
        secretAccessKey:
          type: string
          description: Secret access key (stored encrypted)

    User:
      type: object
      description: Platform user.
      required:
        - id
        - email
      properties:
        id:
          type: string
          description: Unique user identifier
        email:
          type: string
          format: email
          description: User email address
        provider:
          type: string
          nullable: true
          description: OAuth provider if external (e.g., google, github)
        roles:
          type: array
          items:
            type: string
            enum: [superadmin, user]
          description: Global user roles
          example: [user]
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp

    SourceMembership:
      type: object
      description: User membership in a source with roles.
      required:
        - sourceId
        - userId
        - roles
      properties:
        sourceId:
          type: string
          description: Source identifier
          example: default
        userId:
          type: string
          description: User identifier
        roles:
          type: array
          items:
            type: string
            enum: [sourceAdmin, sourceUser]
          description: Roles within the source
          example: [sourceAdmin]

    CreateSourceRequest:
      type: object
      required:
        - name
        - storageConfig
      properties:
        name:
          type: string
          description: Human-readable source name
          minLength: 1
        identifier:
          type: string
          nullable: true
          description: Optional reverse-domain identifier
        storageConfig:
          $ref: '#/components/schemas/StorageConfig'

    UpdateSourceRequest:
      type: object
      properties:
        name:
          type: string
          description: Updated source name
          minLength: 1
        identifier:
          type: string
          nullable: true
          description: Updated identifier
        storageConfig:
          $ref: '#/components/schemas/StorageConfig'
        status:
          type: string
          enum: [active, inactive]

    CreateUserRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User email
        password:
          type: string
          format: password
          description: User password (hashed server-side)
          minLength: 8

    CreateMembershipRequest:
      type: object
      required:
        - userId
        - sourceId
        - roles
      properties:
        userId:
          type: string
          description: User ID to assign
        sourceId:
          type: string
          description: Source ID
        roles:
          type: array
          items:
            type: string
            enum: [sourceAdmin, sourceUser]
          description: Roles within the source
          minItems: 1

    CreateVersionResponse:
      type: object
      description: Response after creating a version; includes presigned upload URL.
      required:
        - version
        - uploadURL
      properties:
        version:
          type: string
          description: Semantic version
        uploadURL:
          type: string
          format: uri
          description: Presigned S3/MinIO URL for uploading IPA file (expires in 1 hour)
        date:
          type: string
          format: date
          description: Release date
        localizedDescription:
          type: string
          nullable: true
          description: Release notes
        minOSVersion:
          type: string
          nullable: true
        sha256:
          type: string
          nullable: true

    AppPublic:
      type: object
      description: Public application object for distribution (without sensitive metadata).
      required:
        - name
        - bundleIdentifier
        - developerName
      properties:
        name:
          type: string
          description: Human-readable name of the app
          example: My App
        bundleIdentifier:
          type: string
          description: |
            Unique bundle identifier for the app.
            Reverse-domain format recommended (e.g., com.example.app).
          example: com.example.app
        developerName:
          type: string
          description: Name of the app developer
          example: Example Dev
        subtitle:
          type: string
          nullable: true
          description: Optional subtitle or tagline for the app
          example: A cool app
        iconURL:
          type: string
          format: uri
          nullable: true
          description: URL to the app's icon image
          example: https://example.com/icon.png
        versions:
          type: array
          description: List of versions for this app
          items:
            $ref: '#/components/schemas/AppVersion'
          default: []

    Source:
      type: object
      description: AltStore source object containing apps and metadata.
      required:
        - name
        - identifier
      properties:
        name:
          type: string
          description: Human-readable name of the source
          example: My Source
        identifier:
          type: string
          description: Unique identifier for the source (reverse-domain format recommended)
          example: com.example.source
        apps:
          type: array
          description: List of apps in this source
          items:
            $ref: '#/components/schemas/App'
          default: []

    App:
      type: object
      description: Application object containing app metadata and versions.
      required:
        - name
        - bundleIdentifier
        - developerName
      properties:
        name:
          type: string
          description: Human-readable name of the app
          example: My App
        bundleIdentifier:
          type: string
          description: |
            Unique bundle identifier for the app (immutable after creation).
            Reverse-domain format recommended (e.g., com.example.app).
          example: com.example.app
        developerName:
          type: string
          description: Name of the app developer
          example: Example Dev
        subtitle:
          type: string
          nullable: true
          description: Optional subtitle or tagline for the app
          example: A cool app
        iconURL:
          type: string
          format: uri
          nullable: true
          description: URL to the app's icon image
          example: https://example.com/icon.png
        versions:
          type: array
          description: List of versions for this app
          items:
            $ref: '#/components/schemas/AppVersion'
          default: []

    AppVersion:
      type: object
      description: Specific version of an application with presigned download URL.
      required:
        - version
        - date
      properties:
        version:
          type: string
          description: |
            Semantic version string (immutable after creation).
            Format: MAJOR.MINOR.PATCH (e.g., 1.0.0)
          example: '1.0.0'
        date:
          type: string
          format: date
          description: Release date in ISO 8601 format (YYYY-MM-DD)
          example: '2025-01-01'
        localizedDescription:
          type: string
          nullable: true
          description: Release notes or description for this version
          example: Initial release
        downloadURL:
          type: string
          format: uri
          nullable: true
          description: Presigned S3/MinIO URL for IPA file download (auto-generated on creation)
          example: https://s3.example.com/bucket/com.example.app/1.0.0.ipa?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=...&X-Amz-Expires=3600&...
        size:
          type: integer
          format: int64
          nullable: true
          description: Size of the IPA file in bytes
          example: 50000000
        minOSVersion:
          type: string
          nullable: true
          description: Minimum iOS version required (e.g., "14.0")
          example: '14.0'
        sha256:
          type: string
          nullable: true
          description: SHA256 checksum of the IPA file (64 hex characters)
          example: abc123def456...

    CreateAppRequest:
      type: object
      description: Request body for creating a new app.
      required:
        - name
        - bundleIdentifier
        - developerName
      properties:
        name:
          type: string
          description: Human-readable name of the app
          minLength: 1
          example: My App
        bundleIdentifier:
          type: string
          description: |
            Unique bundle identifier for the app.
            Reverse-domain format recommended (e.g., com.example.app).
          minLength: 1
          example: com.example.app
        developerName:
          type: string
          description: Name of the app developer
          minLength: 1
          example: Example Dev
        subtitle:
          type: string
          nullable: true
          description: Optional subtitle or tagline for the app
          example: A cool app
        iconURL:
          type: string
          format: uri
          nullable: true
          description: URL to the app's icon image
          example: https://example.com/icon.png

    UpdateAppRequest:
      type: object
      description: Request body for updating an app. All fields are optional.
      properties:
        name:
          type: string
          description: Human-readable name of the app
          minLength: 1
          example: Updated App Name
        developerName:
          type: string
          description: Name of the app developer
          minLength: 1
          example: New Developer
        subtitle:
          type: string
          nullable: true
          description: Optional subtitle or tagline for the app
          example: Updated subtitle
        iconURL:
          type: string
          format: uri
          nullable: true
          description: URL to the app's icon image
          example: https://example.com/new-icon.png

    CreateVersionRequest:
      type: object
      description: Request body for creating a new app version. Presigned upload URL is generated by the server.
      required:
        - version
        - date
      properties:
        version:
          type: string
          description: |
            Semantic version string.
            Format: MAJOR.MINOR.PATCH (e.g., 1.0.0)
          minLength: 1
          example: '1.0.0'
        date:
          type: string
          format: date
          description: Release date in ISO 8601 format (YYYY-MM-DD)
          example: '2025-01-01'
        localizedDescription:
          type: string
          nullable: true
          description: Release notes or description for this version
          example: Initial release
        size:
          type: integer
          format: int64
          nullable: true
          description: Size of the IPA file in bytes
          minimum: 0
          example: 50000000
        minOSVersion:
          type: string
          nullable: true
          description: Minimum iOS version required (e.g., "14.0")
          example: '14.0'
        sha256:
          type: string
          nullable: true
          description: |
            SHA256 checksum of the IPA file.
            Must be 64 hexadecimal characters if provided.
          pattern: '^[a-fA-F0-9]{64}$'
          example: abc123def456...

    UpdateVersionRequest:
      type: object
      description: |
        Request body for updating an app version. All fields are optional.
        The version string cannot be changed.
      properties:
        date:
          type: string
          format: date
          description: Release date in ISO 8601 format (YYYY-MM-DD)
          example: '2025-01-02'
        localizedDescription:
          type: string
          nullable: true
          description: Release notes or description for this version
          example: Updated release notes
        size:
          type: integer
          format: int64
          nullable: true
          description: Size of the IPA file in bytes
          minimum: 0
          example: 51000000
        minOSVersion:
          type: string
          nullable: true
          description: Minimum iOS version required (e.g., "14.0")
          example: '14.0'
        sha256:
          type: string
          nullable: true
          description: |
            SHA256 checksum of the IPA file.
            Must be 64 hexadecimal characters if provided.
          pattern: '^[a-fA-F0-9]{64}$'
          example: def456abc123...

    Error:
      type: object
      description: Standard error response object.
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error type or category
          example: Validation failed
        message:
          type: string
          description: Human-readable error message
          example: bundleIdentifier is required
        details:
          type: string
          nullable: true
          description: Additional context or details about the error
          example: null
